<!DOCTYPE html>
<html lang="ko">

<head>
  <title>xwood</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <link rel="stylesheet" href="../css/style.min.css">
  <script type="text/javascript" src="../js/jquery.min.js"></script>
  <script type="text/javascript" src="../js/common.js"></script>
</head>

<body class="subpage">
  <div id="wrap">
    <header id="header">
      <h1 id="top-logo">
        <a href="../index.html">XWOOD</a>
      </h1>
      <!-- 메인메뉴 -->
      <nav id="top-nav">
        <ul>
          <li>
            <a href="../company/introduce.html">Company</a>
            <ul class="sub-menu">
              <li><a href="../company/introduce.html">Introduce</a></li>
              <li><a href="../company/ci.html">CI</a></li>
              <li><a href="../company/history.html">History</a></li>
            </ul>
          </li>
          <li><a href="../product/product.html">Product</a></li>
          <li><a href="../gallery/gallery.html">Gallery</a></li>
          <li>
            <a href="../community/notice.html">Community</a>
            <ul class="sub-menu">
              <li><a href="../community/notice.html">Notice</a></li>
              <li><a href="../community/faq.html">FAQ</a></li>
            </ul>
          </li>
          <li><a href="../location/location.html">Location</a></li>
        </ul>
      </nav>
    </header>
    <main>
      <!-- 컨텐츠 영역 -->
      <div class="container">
        <!-- 왼쪽 메뉴 -->
        <aside id="lnb">
          <ul>
            <li><a href="../company/location.html">Location</a></li>
          </ul>
        </aside>
        <!-- 컨텐츠 본문 영역 -->
        <div class="content">
          <h2 class="sub-title"><span>Location</span></h2>
          <div class="inner">
            <div id="map" style="width: 1000px; height: 350px; margin: 50px auto 0;"></div>
          </div>
        </div>
      </div>
    </main>
    <footer id="footer">
      &copy;copyright all rights reserved.
    </footer>
  </div>
  <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=e18a27c6f9516c62bd609f808706a8f6"></script>
  <script>
    var container = document.getElementById('container'), // 지도와 로드뷰를 감싸고 있는 div 입니다
      mapWrapper = document.getElementById('mapWrapper'), // 지도를 감싸고 있는 div 입니다
      btnRoadview = document.getElementById('btnRoadview'), // 지도 위의 로드뷰 버튼, 클릭하면 지도는 감춰지고 로드뷰가 보입니다
      btnMap = document.getElementById('btnMap'), // 로드뷰 위의 지도 버튼, 클릭하면 로드뷰는 감춰지고 지도가 보입니다
      rvContainer = document.getElementById('roadview'), // 로드뷰를 표시할 div 입니다
      mapContainer = document.getElementById('map'); // 지도를 표시할 div 입니다

    // 지도와 로드뷰 위에 마커로 표시할 특정 장소의 좌표입니다
    var placePosition = new kakao.maps.LatLng(35.8660426, 128.5938422);

    // 지도 옵션입니다
    var mapOption = {
      center: placePosition, // 지도의 중심좌표
      level: 3 // 지도의 확대 레벨
    };

    // 지도를 표시할 div와 지도 옵션으로 지도를 생성합니다
    var map = new kakao.maps.Map(mapContainer, mapOption);

    var overlayOn = false, // 지도 위에 로드뷰 오버레이가 추가된 상태를 가지고 있을 변수
      container = document.getElementById('container'), // 지도와 로드뷰를 감싸고 있는 div 입니다
      mapWrapper = document.getElementById('mapWrapper'), // 지도를 감싸고 있는 div 입니다
      mapContainer = document.getElementById('map'), // 지도를 표시할 div 입니다
      rvContainer = document.getElementById('roadview'); //로드뷰를 표시할 div 입니다

    var mapCenter = new kakao.maps.LatLng(33.45042, 126.57091), // 지도의 중심좌표
      mapOption = {
        center: mapCenter, // 지도의 중심좌표
        level: 3 // 지도의 확대 레벨
      };

    // 지도를 표시할 div와 지도 옵션으로 지도를 생성합니다
    var map = new kakao.maps.Map(mapContainer, mapOption);

    // 로드뷰 객체를 생성합니다
    var rv = new kakao.maps.Roadview(rvContainer);

    // 좌표로부터 로드뷰 파노라마 ID를 가져올 로드뷰 클라이언트 객체를 생성합니다
    var rvClient = new kakao.maps.RoadviewClient();

    // 로드뷰에 좌표가 바뀌었을 때 발생하는 이벤트를 등록합니다
    kakao.maps.event.addListener(rv, 'position_changed', function() {

      // 현재 로드뷰의 위치 좌표를 얻어옵니다
      var rvPosition = rv.getPosition();

      // 지도의 중심을 현재 로드뷰의 위치로 설정합니다
      map.setCenter(rvPosition);

      // 지도 위에 로드뷰 도로 오버레이가 추가된 상태이면
      if (overlayOn) {
        // 마커의 위치를 현재 로드뷰의 위치로 설정합니다
        marker.setPosition(rvPosition);
      }
    });

    // 마커 이미지를 생성합니다
    var markImage = new kakao.maps.MarkerImage(
      'https://t1.daumcdn.net/localimg/localimages/07/2018/pc/roadview_minimap_wk_2018.png',
      new kakao.maps.Size(26, 46), {
        // 스프라이트 이미지를 사용합니다.
        // 스프라이트 이미지 전체의 크기를 지정하고
        spriteSize: new kakao.maps.Size(1666, 168),
        // 사용하고 싶은 영역의 좌상단 좌표를 입력합니다.
        // background-position으로 지정하는 값이며 부호는 반대입니다.
        spriteOrigin: new kakao.maps.Point(705, 114),
        offset: new kakao.maps.Point(13, 46)
      }
    );

    // 드래그가 가능한 마커를 생성합니다
    var marker = new kakao.maps.Marker({
      image: markImage,
      position: mapCenter,
      draggable: true
    });

    // 마커에 dragend 이벤트를 등록합니다
    kakao.maps.event.addListener(marker, 'dragend', function(mouseEvent) {

      // 현재 마커가 놓인 자리의 좌표입니다
      var position = marker.getPosition();

      // 마커가 놓인 위치를 기준으로 로드뷰를 설정합니다
      toggleRoadview(position);
    });

    //지도에 클릭 이벤트를 등록합니다
    kakao.maps.event.addListener(map, 'click', function(mouseEvent) {

      // 지도 위에 로드뷰 도로 오버레이가 추가된 상태가 아니면 클릭이벤트를 무시합니다
      if (!overlayOn) {
        return;
      }

      // 클릭한 위치의 좌표입니다
      var position = mouseEvent.latLng;

      // 마커를 클릭한 위치로 옮깁니다
      marker.setPosition(position);

      // 클락한 위치를 기준으로 로드뷰를 설정합니다
      toggleRoadview(position);
    });

    // 전달받은 좌표(position)에 가까운 로드뷰의 파노라마 ID를 추출하여
    // 로드뷰를 설정하는 함수입니다
    function toggleRoadview(position) {
      rvClient.getNearestPanoId(position, 50, function(panoId) {
        // 파노라마 ID가 null 이면 로드뷰를 숨깁니다
        if (panoId === null) {
          toggleMapWrapper(true, position);
        } else {
          toggleMapWrapper(false, position);

          // panoId로 로드뷰를 설정합니다
          rv.setPanoId(panoId, position);
        }
      });
    }

    // 지도를 감싸고 있는 div의 크기를 조정하는 함수입니다
    function toggleMapWrapper(active, position) {
      if (active) {

        // 지도를 감싸고 있는 div의 너비가 100%가 되도록 class를 변경합니다
        container.className = '';

        // 지도의 크기가 변경되었기 때문에 relayout 함수를 호출합니다
        map.relayout();

        // 지도의 너비가 변경될 때 지도중심을 입력받은 위치(position)로 설정합니다
        map.setCenter(position);
      } else {

        // 지도만 보여지고 있는 상태이면 지도의 너비가 50%가 되도록 class를 변경하여
        // 로드뷰가 함께 표시되게 합니다
        if (container.className.indexOf('view_roadview') === -1) {
          container.className = 'view_roadview';

          // 지도의 크기가 변경되었기 때문에 relayout 함수를 호출합니다
          map.relayout();

          // 지도의 너비가 변경될 때 지도중심을 입력받은 위치(position)로 설정합니다
          map.setCenter(position);
        }
      }
    }

    // 지도 위의 로드뷰 도로 오버레이를 추가,제거하는 함수입니다
    function toggleOverlay(active) {
      if (active) {
        overlayOn = true;

        // 지도 위에 로드뷰 도로 오버레이를 추가합니다
        map.addOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW);

        // 지도 위에 마커를 표시합니다
        marker.setMap(map);

        // 마커의 위치를 지도 중심으로 설정합니다
        marker.setPosition(map.getCenter());

        // 로드뷰의 위치를 지도 중심으로 설정합니다
        toggleRoadview(map.getCenter());
      } else {
        overlayOn = false;

        // 지도 위의 로드뷰 도로 오버레이를 제거합니다
        map.removeOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW);

        // 지도 위의 마커를 제거합니다
        marker.setMap(null);
      }
    }

    // 지도 위의 로드뷰 버튼을 눌렀을 때 호출되는 함수입니다
    function setRoadviewRoad() {
      var control = document.getElementById('roadviewControl');

      // 버튼이 눌린 상태가 아니면
      if (control.className.indexOf('active') === -1) {
        control.className = 'active';

        // 로드뷰 도로 오버레이가 보이게 합니다
        toggleOverlay(true);
      } else {
        control.className = '';

        // 로드뷰 도로 오버레이를 제거합니다
        toggleOverlay(false);
      }
    }

    // 로드뷰에서 X버튼을 눌렀을 때 로드뷰를 지도 뒤로 숨기는 함수입니다
    function closeRoadview() {
      var position = marker.getPosition();
      toggleMapWrapper(true, position);
    }

    // 지도 중심을 표시할 마커를 생성하고 특정 장소 위에 표시합니다
    var mapMarker = new kakao.maps.Marker({
      position: placePosition,
      map: map
    });

    // 로드뷰 초기화가 완료되면
    kakao.maps.event.addListener(roadview, 'init', function() {

      // 로드뷰에 특정 장소를 표시할 마커를 생성하고 로드뷰 위에 표시합니다
      var rvMarker = new kakao.maps.Marker({
        position: placePosition,
        map: roadview
      });
    });

    // 지도와 로드뷰를 감싸고 있는 div의 class를 변경하여 지도를 숨기거나 보이게 하는 함수입니다
    function toggleMap(active) {
      if (active) {

        // 지도가 보이도록 지도와 로드뷰를 감싸고 있는 div의 class를 변경합니다
        container.className = "view_map"
      } else {

        // 지도가 숨겨지도록 지도와 로드뷰를 감싸고 있는 div의 class를 변경합니다
        container.className = "view_roadview"
      }
    }

    // 인포윈도우로 장소에 대한 설명을 표시합니다
    var infowindow = new kakao.maps.InfoWindow({
      content: '<div class="map-info">코리아IT학원</div>'
    });
    infowindow.open(map, marker);

    // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
    map.setCenter(coords);
  </script>
</body>

</html>
